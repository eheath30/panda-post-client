const form=document.querySelector("#new-post-form"),postList=document.querySelector("table"),viewBtn=document.getElementById("view"),url="http://localhost:3000/posts/";async function updateContent(){let e=window.location.hash.substring(1);if(console.log("updateContent",e),e){form.remove();let t=e.substring(5);console.log(t);let n=await fetch(`${url}${t}`),o=(await n.json()).posts;console.log("posts:",o);let l=document.querySelector("#postBody"),s=document.createElement("section"),d=document.createElement("h1"),i=document.createElement("h2"),a=document.createElement("p"),c=document.createElement("h3"),r=document.createElement("button"),u=document.createElement("button");console.log(l),d.textContent=o.title,i.textContent=o.alias,a.textContent=o.description,c.textContent=o.date,r.innerHTML='Edit post <i class="fa-solid fa-pen-to-square"></i>',r.setAttribute("id",t),r.setAttribute("class","editBtn btn btn-outline-secondary mx-2"),a.setAttribute("class","p-description"),u.textContent="delete",u.setAttribute("id",t),u.setAttribute("class","deleteBtn btn btn-danger btn-xs"),r.addEventListener("click",editPost),u.addEventListener("click",deletePost),s.appendChild(d),s.appendChild(i),s.appendChild(c),s.appendChild(a),s.appendChild(r),s.appendChild(u),l.appendChild(s)}}async function submitPost(e){e.preventDefault(),console.log(e);const t=e.target.title.value,n=e.target.alias.value,o=e.target.description.value,l=(new Date).toLocaleString("default",{month:"long",day:"numeric",year:"numeric"});if(console.log(l),""==t||""==n||""==o)submissionError();else{const t={title:e.target.title.value,alias:e.target.alias.value,description:e.target.description.value,date:l},n={method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}};await fetch("http://localhost:3000/posts",n);getNewPostId(t)}}function submissionError(){let e=document.getElementById("errornote");console.log(e),null==e&&(e=document.createElement("p"),e.textContent="all fields require input",e.style.color="red",e.setAttribute("id","errornote"),form.appendChild(e))}async function getNewPostId(e){console.log(e);let t=await fetch("http://localhost:3000/posts"),n=(await t.json()).posts;console.log(n);let o=n[n.length-1].id;console.log(o),window.location.hash=`#post/${o}`,form.remove();let l=document.querySelector("#postBody"),s=document.createElement("section"),d=document.createElement("h1"),i=document.createElement("h2"),a=document.createElement("p"),c=document.createElement("h3"),r=document.createElement("button"),u=document.createElement("button");console.log(l),d.textContent=e.title,i.textContent=e.alias,a.textContent=e.description,c.textContent=e.date,r.innerHTML='Edit post <i class="fa-solid fa-pen-to-square"></i>',r.setAttribute("id",o),a.setAttribute("class","p-description"),r.setAttribute("class","editBtn btn btn-outline-secondary mx-2"),u.textContent="delete",u.setAttribute("id",o),u.setAttribute("class","deleteBtn btn btn-danger btn-xs"),r.addEventListener("click",editPost),u.addEventListener("click",deletePost),s.appendChild(d),s.appendChild(i),s.appendChild(c),s.appendChild(a),s.appendChild(r),s.appendChild(u),l.appendChild(s)}async function getPost(e){try{const t=await fetch(`http://localhost:3000/${e}`);return await t.json()}catch(e){console.warn(e)}}function editPost(){console.log("test");let e=document.querySelector("button"),t=document.getElementsByClassName("deleteBtn")[0],n=document.querySelector("section"),o=document.querySelector(".p-description");console.log(o);let l=document.querySelector("p").textContent,s=document.createElement("button");s.setAttribute("id",`${e.id}-p`),s.innerHTML='publish post <i class="fa-solid fa-paper-plane"></i>',s.className="btn btn-outline-secondary",o.remove();let d=document.createElement("textarea");d.value=l,d.className="form-control",linebreak=document.createElement("br"),s.addEventListener("click",publishPost),n.appendChild(d),n.appendChild(linebreak),n.appendChild(s),e.remove(),t.remove()}async function publishPost(e){console.log(e);let t=document.querySelector("button").id,n=t.slice(0,t.indexOf("-"));const o=(new Date).toLocaleString("default",{month:"long",day:"numeric",year:"numeric"}),l={title:e.target.parentNode.childNodes[0].textContent,alias:e.target.parentNode.childNodes[1].textContent,description:e.target.parentNode.childNodes[3].value,date:o},s={method:"PUT",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}};fetch(`http://localhost:3000/posts/${n}`,s).then((e=>e.json())).then(renderEditedPost(l)).catch(console.warn),console.log(n,l)}function renderEditedPost(e){let t=document.querySelector("section"),n=document.querySelector("button");n.remove(),document.querySelector("textarea").remove();let o=document.createElement("p"),l=document.createElement("button");l.innerHTML='Edit post <i class="fa-solid fa-pen-to-square"></i>',l.setAttribute("id",`${n.id}`),l.addEventListener("click",editPost),l.setAttribute("class","editBtn btn btn-outline-secondary mx-2"),o.textContent=e.description,o.setAttribute("class","p-description"),t.appendChild(o),t.appendChild(l)}function deletePost(e){console.log(e);const t=e.target.id;fetch(`http://localhost:3000/posts/${t}`,{method:"DELETE"}).then(e.target.parentNode.remove()).then(deletePostalert()).catch(console.warn)}function deletePostalert(){let e=document.getElementById("postBody"),t=document.createElement("h1");t.setAttribute("class","text-center"),t.textContent="Post deleted 🐼",e.appendChild(t)}window.addEventListener("load",updateContent),form.addEventListener("submit",submitPost),viewBtn.addEventListener("click",(()=>{document.location.href="./hero.html"}));
